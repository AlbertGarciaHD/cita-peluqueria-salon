let paso=1;const pasoInicial=1,pasoFinal=3,citas={nombre:"",fecha:"",hora:"",servicios:[],idServicios:[]};function inicialApp(){mostrarSession(),tabs(),paginador(),paginaSigueinte(),paginaAnterior(),consultarAPI(),mostrarNombre(),selecionarFecha(),selecionarHora(),mostrarResumen()}function tabs(){document.querySelectorAll(".tabs button").forEach((e=>{e.addEventListener("click",(e=>{paso=parseInt(e.target.dataset.paso),mostrarSession(),paginador()}))}))}function mostrarSession(){const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar");document.querySelector(`#paso-${paso}`).classList.add("mostrar");const t=document.querySelector(".tab-activo");t&&t.classList.remove("tab-activo");document.querySelector(`[data-paso="${paso}"]`).classList.add("tab-activo")}function paginador(){const e=document.querySelector("#siguiente"),t=document.querySelector("#anterior"),o=document.querySelector("#boton-reservar");o&&3!=paso&&o.remove(),1===paso?(t.classList.add("ocultar-btn"),e.classList.remove("ocultar-btn")):2===paso?(t.classList.remove("ocultar-btn"),e.classList.remove("ocultar-btn")):3===paso&&(t.classList.remove("ocultar-btn"),e.classList.add("ocultar-btn"),mostrarResumen())}function paginaAnterior(){document.querySelector("#anterior").addEventListener("click",(()=>{paso<=pasoInicial||(paso--,mostrarSession(),paginador())}))}function paginaSigueinte(){document.querySelector("#siguiente").addEventListener("click",(()=>{paso>=pasoFinal||(paso++,mostrarSession(),paginador())}))}async function consultarAPI(){try{const e="http://localhost:8082/api/servicios",t=await fetch(e),o=await t.json();mostrarServicios(o),console.log(o)}catch(e){console.log(e)}}function mostrarServicios(e){const t=document.querySelector("#servicios");e.innerHTML="",e.forEach((e=>{const{id:o,nombre:a,precio:r}=e,n=document.createElement("P");n.classList.add("nombre-servicio"),n.textContent=a;const s=document.createElement("P");s.classList.add("precio-servicio"),s.textContent=`$ ${r}`;const c=document.createElement("DIV");c.classList.add("servicio"),c.dataset.idServicio=o,c.onclick=()=>seleccionarServicio(e),c.appendChild(n),c.appendChild(s),t.appendChild(c)}))}function seleccionarServicio(e){const{servicios:t}=citas,{id:o}=e,a=document.querySelector(`[data-id-servicio="${o}"]`);t.some((e=>e.id===o))?(citas.servicios=t.filter((e=>e.id!==o)),a.classList.remove("seleccionado")):(citas.servicios=[...t,e],a.classList.add("seleccionado"))}function mostrarNombre(){citas.nombre=document.querySelector("#nombre").value}function selecionarFecha(){document.querySelector("#fecha").addEventListener("input",(e=>{const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(e.target.value="",mostrarAlerta("No se puede agendar en fin de semana","error")):citas.fecha=e.target.value}))}function selecionarHora(){document.querySelector("#hora").addEventListener("input",(e=>{const t=e.target.value.split(":")[0];t<9||t>18?(mostrarAlerta("La hora no es vÃ¡lida","error"),e.target.value=""):citas.hora=e.target.value}))}function mostrarAlerta(e,t="exito",o="#paso-2 p",a=!0){const r=document.querySelector(".alerta");r&&r.remove();const n=document.createElement("D");n.textContent=e,n.classList.add("alerta"),n.classList.add(t);document.querySelector(`${o}`).appendChild(n),a&&setTimeout((()=>{n.remove()}),3e3)}function mostrarResumen(){const e=document.querySelector(".contenido-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(citas).includes("")||0===citas.servicios.length)return void mostrarAlerta("Todos los campos son obligatorios","error","#paso-3",!1);const{nombre:t,fecha:o,hora:a,servicios:r}=citas,n=(r.reduce(((e,t)=>e+t.precio),0),document.createElement("H3"));n.classList.add("resumen-servicios"),n.innerHTML="Resumen de Servicios",e.appendChild(n),r.forEach((t=>{const o=document.createElement("DIV");o.classList.add("contenedor-servicio");const a=document.createElement("P");a.innerHTML=t.nombre;const r=document.createElement("P");r.innerHTML=`<span>Precio:</span> $${t.precio}`,o.appendChild(a),o.appendChild(r),e.appendChild(o)}));const s=document.createElement("H3");s.classList.add("cita-servicios"),s.innerHTML="Resumen de Cita",e.appendChild(s);const c=document.createElement("P");c.innerHTML=`<span>Nombre: </span>${t}`,e.appendChild(c);const i=document.createElement("P");i.innerHTML=`<span>Fecha: </span>${formatearFecha(o)}`,e.appendChild(i);const d=document.createElement("P");d.innerHTML=`<span>Hora: </span>${a}`,e.appendChild(d);const l=document.createElement("BUTTON");l.classList.add("button"),l.id="boton-reservar",l.textContent="Reservar",l.onclick=reservarCita;document.querySelector(".paginacion").appendChild(l)}function formatearFecha(e){return new Date(e).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}async function reservarCita(){const e=new FormData;citas.idServicios=citas.servicios.map((e=>e.id)),e.append("nombre",citas.nombre),e.append("fecha",citas.fecha),e.append("hora",citas.hora),e.append("servicios",citas.idServicios);try{const t="http://localhost:8082/api/citas";$resultado=await fetch(t,{method:"POST",body:e}),resultado=await $resultado.json(),resultado.cod&&"00"===resultado.cod?Swal.fire({icon:"success",title:"Cita Creada",text:"Tu cita ha sido creada correctamente",button:"Ok"}).then((()=>{window.location.reload()})):Swal.fire({icon:"error",title:"Error",text:"Hubo un error al crear la cita",button:"Ok"}),console.log(resultado)}catch(e){Swal.fire({icon:"error",title:"Error",text:"Hubo un error al crear la cita",button:"Ok"})}}document.addEventListener("DOMContentLoaded",(()=>{inicialApp()}));